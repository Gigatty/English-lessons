<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PEP äº”å¹´çº§ä¸‹å†Œ Â· Duolingo-Style Audio Lessons</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --green: #58cc02;
  --green-dark: #46a302;
  --green-light: #d7ffb8;
  --blue: #1cb0f6;
  --blue-dark: #0f8bc0;
  --orange: #ff9600;
  --red: #ff4b4b;
  --purple: #ce82ff;
  --gold: #ffc800;
  --bg: #131f24;
  --bg-card: #1a2b32;
  --bg-surface: #233a44;
  --text: #ffffff;
  --text-dim: #93b0bc;
  --text-muted: #5a7a88;
  --border: #2b4450;
  --radius: 16px;
  --radius-sm: 12px;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Nunito', 'Noto Sans SC', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}

/* â•â•â• HEADER â•â•â• */
.app-header {
  background: var(--bg-card);
  border-bottom: 2px solid var(--border);
  padding: 16px 20px;
  display: flex;
  align-items: center;
  gap: 14px;
  position: sticky;
  top: 0;
  z-index: 100;
}
.app-logo {
  width: 40px; height: 40px;
  background: var(--green);
  border-radius: 12px;
  display: flex; align-items: center; justify-content: center;
  font-size: 22px;
  box-shadow: 0 4px 0 var(--green-dark);
}
.app-title { font-weight: 800; font-size: 18px; flex: 1; }
.app-title span { color: var(--green); }
.voice-status {
  font-size: 11px; font-weight: 700;
  padding: 4px 10px; border-radius: 20px;
  text-transform: uppercase; letter-spacing: 1px;
}
.voice-status.ready { background: var(--green); color: #000; }
.voice-status.loading { background: var(--orange); color: #000; }
.voice-status.error { background: var(--red); color: #fff; }

/* â•â•â• LAYOUT â•â•â• */
.app-container {
  max-width: 680px;
  margin: 0 auto;
  padding: 20px 16px 120px;
}

/* â•â•â• UNIT SELECTOR â•â•â• */
.unit-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  margin-bottom: 24px;
}
.unit-btn {
  background: var(--bg-surface);
  border: 2px solid var(--border);
  border-radius: var(--radius);
  padding: 16px 12px;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
  overflow: hidden;
}
.unit-btn:hover { border-color: var(--green); transform: translateY(-2px); }
.unit-btn.active {
  border-color: var(--green);
  background: linear-gradient(135deg, rgba(88,204,2,0.15), rgba(88,204,2,0.05));
  box-shadow: 0 0 20px rgba(88,204,2,0.1);
}
.unit-btn .unit-num {
  font-size: 28px; font-weight: 900;
  background: linear-gradient(135deg, var(--green), var(--blue));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  background-clip: text;
}
.unit-btn .unit-name {
  font-size: 11px; font-weight: 700;
  color: var(--text-dim); margin-top: 4px;
  text-transform: uppercase; letter-spacing: 0.5px;
  line-height: 1.3;
}

/* â•â•â• LESSON SELECTOR â•â•â• */
.lesson-tabs {
  display: flex; gap: 8px;
  margin-bottom: 20px;
  overflow-x: auto; scrollbar-width: none;
}
.lesson-tabs::-webkit-scrollbar { display: none; }
.lesson-tab {
  flex-shrink: 0;
  padding: 10px 18px;
  border-radius: 30px;
  border: 2px solid var(--border);
  background: var(--bg-surface);
  font-family: 'Nunito', sans-serif;
  font-size: 13px; font-weight: 700;
  color: var(--text-dim);
  cursor: pointer;
  transition: all 0.2s;
}
.lesson-tab:hover { border-color: var(--text-dim); }
.lesson-tab.active {
  background: var(--green);
  border-color: var(--green);
  color: #000;
  box-shadow: 0 4px 0 var(--green-dark);
}

/* â•â•â• PLAYER CARD â•â•â• */
.player-card {
  background: var(--bg-card);
  border: 2px solid var(--border);
  border-radius: 20px;
  overflow: hidden;
  margin-bottom: 20px;
}
.player-header {
  padding: 24px 24px 0;
  display: flex; align-items: center; gap: 14px;
}
.player-icon {
  width: 56px; height: 56px;
  border-radius: 16px;
  display: flex; align-items: center; justify-content: center;
  font-size: 28px;
  box-shadow: 0 4px 0 rgba(0,0,0,0.3);
}
.player-meta { flex: 1; }
.player-meta h2 { font-size: 18px; font-weight: 800; }
.player-meta .player-sub {
  font-size: 12px; color: var(--text-dim); font-weight: 600; margin-top: 2px;
}

/* â•â•â• NOW PLAYING â•â•â• */
.now-playing {
  padding: 20px 24px;
  min-height: 180px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
}
.np-step {
  font-size: 11px; font-weight: 800;
  color: var(--green);
  text-transform: uppercase;
  letter-spacing: 2px;
  margin-bottom: 12px;
}
.np-english {
  font-size: clamp(20px, 4vw, 28px);
  font-weight: 800;
  color: var(--text);
  margin-bottom: 8px;
  line-height: 1.3;
  transition: opacity 0.3s;
}
.np-chinese {
  font-family: 'Noto Sans SC', sans-serif;
  font-size: clamp(14px, 2.5vw, 17px);
  color: var(--text-dim);
  font-weight: 500;
  transition: opacity 0.3s;
}
.np-phonetic {
  font-size: 13px;
  color: var(--purple);
  font-weight: 600;
  margin-top: 4px;
}
.np-instruction {
  font-size: 13px;
  color: var(--orange);
  font-weight: 700;
  margin-top: 12px;
  display: flex; align-items: center; gap: 6px;
}

/* â•â•â• PROGRESS BAR â•â•â• */
.progress-wrap {
  padding: 0 24px 4px;
}
.progress-bar {
  height: 10px;
  background: var(--bg-surface);
  border-radius: 10px;
  overflow: hidden;
  position: relative;
}
.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--green), var(--blue));
  border-radius: 10px;
  transition: width 0.4s ease;
  width: 0%;
  position: relative;
}
.progress-fill::after {
  content: '';
  position: absolute;
  top: 0; right: 0;
  width: 12px; height: 100%;
  background: rgba(255,255,255,0.3);
  border-radius: 0 10px 10px 0;
}
.progress-text {
  display: flex; justify-content: space-between;
  font-size: 11px; color: var(--text-muted);
  font-weight: 700; padding: 6px 0 16px;
}

/* â•â•â• CONTROLS â•â•â• */
.controls {
  padding: 0 24px 24px;
  display: flex;
  gap: 12px;
  align-items: center;
  justify-content: center;
}
.ctrl-btn {
  border: none; border-radius: 50%;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  font-family: 'Nunito', sans-serif;
  font-weight: 800;
  transition: all 0.15s;
}
.ctrl-btn:active { transform: scale(0.92); }
.ctrl-sm {
  width: 48px; height: 48px; font-size: 18px;
  background: var(--bg-surface);
  color: var(--text-dim);
  border: 2px solid var(--border);
}
.ctrl-sm:hover { border-color: var(--text-dim); color: var(--text); }
.ctrl-play {
  width: 72px; height: 72px; font-size: 28px;
  background: var(--green);
  color: #1a3a00;
  box-shadow: 0 6px 0 var(--green-dark);
}
.ctrl-play:hover { background: #64de07; }
.ctrl-play.playing {
  background: var(--orange);
  box-shadow: 0 6px 0 #c77600;
}
.ctrl-play.playing:hover { background: #ffaa22; }

/* â•â•â• SPEED SELECTOR â•â•â• */
.speed-row {
  display: flex; gap: 6px; justify-content: center;
  padding: 0 24px 20px;
}
.speed-btn {
  padding: 6px 14px;
  border-radius: 20px;
  border: 2px solid var(--border);
  background: transparent;
  font-family: 'Nunito', sans-serif;
  font-size: 12px; font-weight: 800;
  color: var(--text-muted);
  cursor: pointer;
  transition: all 0.2s;
}
.speed-btn:hover { border-color: var(--text-dim); }
.speed-btn.active {
  background: var(--purple);
  border-color: var(--purple);
  color: #fff;
}

/* â•â•â• SCRIPT VIEW â•â•â• */
.script-toggle {
  display: flex; justify-content: center;
  padding: 0 24px 20px;
}
.script-toggle button {
  background: var(--bg-surface);
  border: 2px solid var(--border);
  border-radius: 12px;
  padding: 10px 20px;
  font-family: 'Nunito', sans-serif;
  font-size: 13px; font-weight: 700;
  color: var(--text-dim);
  cursor: pointer;
  transition: all 0.2s;
  width: 100%;
}
.script-toggle button:hover { border-color: var(--text-dim); }
.script-list {
  display: none;
  padding: 0 24px 24px;
}
.script-list.show { display: block; }
.script-item {
  display: flex; gap: 12px; align-items: flex-start;
  padding: 10px 0;
  border-bottom: 1px solid var(--border);
  cursor: pointer;
  transition: background 0.2s;
  border-radius: 8px;
  padding: 10px 8px;
}
.script-item:hover { background: var(--bg-surface); }
.script-item.current { background: rgba(88,204,2,0.1); }
.script-idx {
  width: 28px; height: 28px;
  border-radius: 50%;
  background: var(--bg-surface);
  display: flex; align-items: center; justify-content: center;
  font-size: 11px; font-weight: 800;
  color: var(--text-muted);
  flex-shrink: 0;
}
.script-item.current .script-idx {
  background: var(--green);
  color: #000;
}
.script-text-en { font-size: 14px; font-weight: 700; }
.script-text-cn {
  font-family: 'Noto Sans SC', sans-serif;
  font-size: 12px; color: var(--text-dim); margin-top: 2px;
}

/* â•â•â• IDLE STATE â•â•â• */
.idle-state {
  text-align: center;
  padding: 40px 20px;
}
.idle-state .owl { font-size: 64px; margin-bottom: 16px; }
.idle-state h3 { font-size: 18px; font-weight: 800; margin-bottom: 8px; }
.idle-state p { font-size: 14px; color: var(--text-dim); line-height: 1.6; }

/* â•â•â• WAVE ANIMATION â•â•â• */
.wave-bars {
  display: flex; gap: 3px;
  align-items: center;
  justify-content: center;
  height: 24px;
  margin-bottom: 8px;
}
.wave-bars.hidden { display: none; }
.wave-bar {
  width: 4px;
  background: var(--green);
  border-radius: 4px;
  animation: wave 0.8s ease-in-out infinite;
}
.wave-bar:nth-child(1) { height: 8px; animation-delay: 0s; }
.wave-bar:nth-child(2) { height: 16px; animation-delay: 0.1s; }
.wave-bar:nth-child(3) { height: 24px; animation-delay: 0.2s; }
.wave-bar:nth-child(4) { height: 16px; animation-delay: 0.3s; }
.wave-bar:nth-child(5) { height: 8px; animation-delay: 0.4s; }

@keyframes wave {
  0%, 100% { transform: scaleY(0.4); }
  50% { transform: scaleY(1); }
}

/* â•â•â• RESPONSIVE â•â•â• */
@media (max-width: 480px) {
  .unit-grid { grid-template-columns: repeat(2, 1fr); }
  .controls { gap: 10px; }
  .ctrl-play { width: 64px; height: 64px; font-size: 24px; }
}
</style>
</head>
<body>

<div class="app-header">
  <div class="app-logo">ğŸ¦‰</div>
  <div class="app-title">PEP Audio <span>Lessons</span></div>
  <div class="voice-status loading" id="voiceStatus">LOADING</div>
</div>

<div class="app-container">

  <!-- UNIT SELECTOR -->
  <div class="unit-grid" id="unitGrid"></div>

  <!-- LESSON TABS -->
  <div class="lesson-tabs" id="lessonTabs"></div>

  <!-- PLAYER CARD -->
  <div class="player-card" id="playerCard">
    <div class="player-header">
      <div class="player-icon" id="playerIcon" style="background: linear-gradient(135deg, var(--green), #38a802);">ğŸ§</div>
      <div class="player-meta">
        <h2 id="playerTitle">Select a lesson</h2>
        <div class="player-sub" id="playerSub">Choose a unit and lesson to begin</div>
      </div>
    </div>

    <div class="now-playing" id="nowPlaying">
      <div class="idle-state" id="idleState">
        <div class="owl">ğŸ¦‰</div>
        <h3>Ready to learn?</h3>
        <p>Pick a unit above, then press play!<br>Each lesson includes vocabulary, dialogues, and practice drills â€” just like Duolingo.</p>
      </div>
      <div class="wave-bars hidden" id="waveBars">
        <div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div>
      </div>
      <div class="np-step" id="npStep" style="display:none;"></div>
      <div class="np-english" id="npEnglish" style="display:none;"></div>
      <div class="np-chinese" id="npChinese" style="display:none;"></div>
      <div class="np-phonetic" id="npPhonetic" style="display:none;"></div>
      <div class="np-instruction" id="npInstruction" style="display:none;"></div>
    </div>

    <div class="progress-wrap">
      <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
      <div class="progress-text">
        <span id="progressCurrent">0 / 0</span>
        <span id="progressPct">0%</span>
      </div>
    </div>

    <div class="controls">
      <button class="ctrl-btn ctrl-sm" onclick="skipPrev()" title="Previous">â®</button>
      <button class="ctrl-btn ctrl-sm" onclick="replayCurrent()" title="Replay">ğŸ”„</button>
      <button class="ctrl-btn ctrl-play" id="playBtn" onclick="togglePlay()">â–¶</button>
      <button class="ctrl-btn ctrl-sm" onclick="skipNext()" title="Skip">â­</button>
      <button class="ctrl-btn ctrl-sm" onclick="stopPlay()" title="Stop">â¹</button>
    </div>

    <div class="speed-row">
      <button class="speed-btn" onclick="setSpeed(0.7)" data-speed="0.7">0.7Ã—</button>
      <button class="speed-btn active" onclick="setSpeed(0.85)" data-speed="0.85">0.85Ã—</button>
      <button class="speed-btn" onclick="setSpeed(1)" data-speed="1">1Ã—</button>
      <button class="speed-btn" onclick="setSpeed(1.2)" data-speed="1.2">1.2Ã—</button>
    </div>

    <div class="script-toggle">
      <button onclick="toggleScript()">ğŸ“œ Show Full Script</button>
    </div>
    <div class="script-list" id="scriptList"></div>
  </div>

</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LESSON DATA â€” PEP Grade 5 Volume 2 (Duolingo structure)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const UNITS = [
  { id: 1, name: "Following the Rules", cn: "éµå®ˆè§„åˆ™", color: "#ff9600" },
  { id: 2, name: "Our Community", cn: "æˆ‘ä»¬çš„ç¤¾åŒº", color: "#58cc02" },
  { id: 3, name: "Life in Seasons", cn: "ä¸åŒå­£èŠ‚çš„ç”Ÿæ´»", color: "#1cb0f6" },
  { id: 4, name: "My Hometown", cn: "æˆ‘çš„å®¶ä¹¡", color: "#ce82ff" },
  { id: 5, name: "Travelling Around", cn: "å‡ºè¡Œæ–¹å¼", color: "#ff9600" },
  { id: 6, name: "Making a Travel Plan", cn: "åˆ¶å®šæ—…è¡Œè®¡åˆ’", color: "#ff4b4b" },
];

// Each step: { type, en, cn, phonetic?, instruction? }
// Types: "title", "vocab", "sentence", "dialogue", "repeat", "pause", "quiz"

function buildLessons(unitId) {
  const data = LESSON_DATA[unitId];
  if (!data) return {};
  return data;
}

const LESSON_DATA = {
  1: {
    "Vocabulary": [
      { type:"title", en:"Unit 1 â€” Vocabulary Drill", cn:"ç¬¬ä¸€å•å…ƒ â€” è¯æ±‡è®­ç»ƒ" },
      { type:"vocab", en:"must", cn:"å¿…é¡»", phonetic:"/mÊŒst/" },
      { type:"sentence", en:"You must stay in the bus.", cn:"ä½ ä»¬å¿…é¡»å¾…åœ¨è½¦ä¸Šã€‚" },
      { type:"repeat", en:"You must stay in the bus.", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Now you say it!" },
      { type:"pause" },
      { type:"vocab", en:"sir", cn:"å…ˆç”Ÿ", phonetic:"/sÉœËr/" },
      { type:"sentence", en:"Yes, sir.", cn:"å¥½çš„ï¼Œå…ˆç”Ÿã€‚" },
      { type:"repeat", en:"Yes, sir.", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Repeat after me!" },
      { type:"pause" },
      { type:"vocab", en:"inside", cn:"åœ¨â€¦â€¦é‡Œé¢", phonetic:"/ÉªnËˆsaÉªd/" },
      { type:"sentence", en:"Keep your hands inside the bus.", cn:"æŠŠæ‰‹æ”¾åœ¨è½¦å†…ã€‚" },
      { type:"pause" },
      { type:"vocab", en:"scare", cn:"æƒŠå“ï¼›ä½¿å®³æ€•", phonetic:"/skeÉ™r/" },
      { type:"sentence", en:"Please don't scare the animals.", cn:"è¯·ä¸è¦å“åˆ°åŠ¨ç‰©ã€‚" },
      { type:"repeat", en:"Please don't scare the animals.", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Your turn!" },
      { type:"pause" },
      { type:"vocab", en:"password", cn:"å¯†ç ", phonetic:"/ËˆpÉ‘ËswÉœËd/" },
      { type:"sentence", en:"Don't give out your password.", cn:"ä¸è¦æ³„éœ²ä½ çš„å¯†ç ã€‚" },
      { type:"pause" },
      { type:"vocab", en:"line", cn:"é˜Ÿä¼ï¼›è¡Œåˆ—", phonetic:"/laÉªn/" },
      { type:"vocab", en:"wait", cn:"ç­‰å¾…ï¼›ç­‰å€™", phonetic:"/weÉªt/" },
      { type:"sentence", en:"Please stand in line and wait.", cn:"è¯·æ’å¥½é˜Ÿç­‰å€™ã€‚" },
      { type:"repeat", en:"Please stand in line and wait.", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Repeat!" },
      { type:"pause" },
      { type:"vocab", en:"guard", cn:"é—¨å«ï¼›çœ‹å®ˆ", phonetic:"/É¡É‘Ëd/" },
      { type:"vocab", en:"shout", cn:"å¤§å£°è¯´ï¼›å«", phonetic:"/ÊƒaÊŠt/" },
      { type:"sentence", en:"No shouting!", cn:"ä¸è¦å¤§å£°å–Šå«ï¼" },
      { type:"title", en:"Great job! Now let's review.", cn:"å¤ªæ£’äº†ï¼ç°åœ¨æ¥å¤ä¹ ã€‚" },
      { type:"quiz", en:"How do you say å¯†ç  in English?", cn:"password", instruction:"ğŸ’¡ Answer: password" },
      { type:"quiz", en:"How do you say ç­‰å¾… in English?", cn:"wait", instruction:"ğŸ’¡ Answer: wait" },
      { type:"quiz", en:"How do you say é˜Ÿä¼ in English?", cn:"line", instruction:"ğŸ’¡ Answer: line" },
      { type:"title", en:"Vocabulary complete! Well done!", cn:"è¯æ±‡è®­ç»ƒå®Œæˆï¼åšå¾—å¥½ï¼" },
    ],
    "Dialogue A": [
      { type:"title", en:"Unit 1 Part A â€” Animal Park Rules", cn:"ç¬¬ä¸€å•å…ƒ Aéƒ¨åˆ† â€” åŠ¨ç‰©å›­è§„åˆ™" },
      { type:"sentence", en:"Listen to the dialogue carefully.", cn:"è¯·ä»”ç»†å¬å¯¹è¯ã€‚" },
      { type:"pause" },
      { type:"dialogue", en:"Welcome everyone. Listen carefully: You must stay in the bus. Don't go outside.", cn:"æ¬¢è¿å¤§å®¶ã€‚è¯·ä»”ç»†å¬ï¼šä½ ä»¬å¿…é¡»å¾…åœ¨è½¦ä¸Šã€‚ä¸è¦å‡ºå»ã€‚", speaker:"Guide" },
      { type:"dialogue", en:"Yes, sir. Can we touch the animals?", cn:"å¥½çš„ï¼Œå…ˆç”Ÿã€‚æˆ‘ä»¬å¯ä»¥æ‘¸åŠ¨ç‰©å—ï¼Ÿ", speaker:"Mike" },
      { type:"dialogue", en:"No. Don't touch the animals. You must keep your hands inside the bus.", cn:"ä¸å¯ä»¥ã€‚ä¸è¦æ‘¸åŠ¨ç‰©ã€‚ä½ ä»¬å¿…é¡»æŠŠæ‰‹æ”¾åœ¨è½¦é‡Œã€‚", speaker:"Guide" },
      { type:"dialogue", en:"Can we give bananas to the monkeys?", cn:"æˆ‘ä»¬å¯ä»¥ç»™çŒ´å­é¦™è•‰å—ï¼Ÿ", speaker:"Chen Jie" },
      { type:"dialogue", en:"No. You shouldn't feed the animals.", cn:"ä¸å¯ä»¥ã€‚ä½ ä»¬ä¸åº”è¯¥å–‚åŠ¨ç‰©ã€‚", speaker:"Guide" },
      { type:"dialogue", en:"OK.", cn:"å¥½çš„ã€‚", speaker:"Chen Jie" },
      { type:"dialogue", en:"You must also keep quiet. Please don't scare the animals.", cn:"ä½ ä»¬ä¹Ÿå¿…é¡»ä¿æŒå®‰é™ã€‚è¯·ä¸è¦å“åˆ°åŠ¨ç‰©ã€‚", speaker:"Guide" },
      { type:"dialogue", en:"No problem.", cn:"æ²¡é—®é¢˜ã€‚", speaker:"Mike" },
      { type:"dialogue", en:"Great! Let's go!", cn:"å¤ªå¥½äº†ï¼æˆ‘ä»¬èµ°å§ï¼", speaker:"Guide" },
      { type:"pause" },
      { type:"title", en:"Now, let's practice the key sentences.", cn:"ç°åœ¨ï¼Œæ¥ç»ƒä¹ é‡ç‚¹å¥å‹ã€‚" },
      { type:"sentence", en:"You must stay in the bus.", cn:"ä½ ä»¬å¿…é¡»å¾…åœ¨è½¦ä¸Šã€‚" },
      { type:"repeat", en:"You must stay in the bus.", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Repeat!" },
      { type:"sentence", en:"Don't touch the animals.", cn:"ä¸è¦æ‘¸åŠ¨ç‰©ã€‚" },
      { type:"repeat", en:"Don't touch the animals.", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Your turn!" },
      { type:"sentence", en:"You shouldn't feed the animals.", cn:"ä½ ä»¬ä¸åº”è¯¥å–‚åŠ¨ç‰©ã€‚" },
      { type:"repeat", en:"You shouldn't feed the animals.", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Say it!" },
      { type:"title", en:"Excellent! Dialogue A complete!", cn:"å¤ªæ£’äº†ï¼Aéƒ¨åˆ†å¯¹è¯å®Œæˆï¼" },
    ],
    "Dialogue B": [
      { type:"title", en:"Unit 1 Part B â€” At the Museum", cn:"ç¬¬ä¸€å•å…ƒ Béƒ¨åˆ† â€” åœ¨åšç‰©é¦†" },
      { type:"sentence", en:"Listen to the dialogue.", cn:"è¯·å¬å¯¹è¯ã€‚" },
      { type:"pause" },
      { type:"dialogue", en:"Oh no! The line is so long.", cn:"å“¦ä¸ï¼é˜Ÿä¼å¥½é•¿å•Šã€‚", speaker:"Sam" },
      { type:"dialogue", en:"Yes. Everyone should take their turn. We must wait.", cn:"æ˜¯çš„ã€‚æ¯ä¸ªäººéƒ½åº”è¯¥æ’é˜Ÿç­‰å€™ã€‚æˆ‘ä»¬å¿…é¡»ç­‰ã€‚", speaker:"Sarah" },
      { type:"dialogue", en:"Look! What's the guard doing?", cn:"çœ‹ï¼é‚£ä¸ªä¿å®‰åœ¨åšä»€ä¹ˆï¼Ÿ", speaker:"Sam" },
      { type:"dialogue", en:"He's telling people what to do.", cn:"ä»–åœ¨å‘Šè¯‰äººä»¬è¯¥æ€ä¹ˆåšã€‚", speaker:"Sarah" },
      { type:"dialogue", en:"Please stand in line. No shouting. Thank you.", cn:"è¯·ç«™å¥½é˜Ÿã€‚ä¸è¦å¤§å£°å–Šå«ã€‚è°¢è°¢ã€‚", speaker:"Guard" },
      { type:"dialogue", en:"Is he coming over here?", cn:"ä»–èµ°è¿‡æ¥äº†å—ï¼Ÿ", speaker:"Sam" },
      { type:"dialogue", en:"Yes, he is.", cn:"æ˜¯çš„ã€‚", speaker:"Sarah" },
      { type:"dialogue", en:"Please talk quietly, kids.", cn:"å­©å­ä»¬ï¼Œè¯·å°å£°è¯´è¯ã€‚", speaker:"Guard" },
      { type:"dialogue", en:"Yes, sir.", cn:"å¥½çš„ï¼Œå…ˆç”Ÿã€‚", speaker:"Sam" },
      { type:"pause" },
      { type:"sentence", en:"Everyone should take their turn.", cn:"æ¯ä¸ªäººéƒ½åº”è¯¥è½®æµã€‚" },
      { type:"repeat", en:"Everyone should take their turn.", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Repeat!" },
      { type:"sentence", en:"Please stand in line.", cn:"è¯·æ’å¥½é˜Ÿã€‚" },
      { type:"repeat", en:"Please stand in line.", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Your turn!" },
      { type:"title", en:"Unit 1 complete! Amazing work!", cn:"ç¬¬ä¸€å•å…ƒå®Œæˆï¼å¤ªå‰å®³äº†ï¼" },
    ],
  },
  2: {
    "Vocabulary": [
      { type:"title", en:"Unit 2 â€” Vocabulary Drill", cn:"ç¬¬äºŒå•å…ƒ â€” è¯æ±‡è®­ç»ƒ" },
      { type:"vocab", en:"along", cn:"æ²¿ç€ï¼›é¡ºç€", phonetic:"/É™ËˆlÉ’Å‹/" },
      { type:"sentence", en:"Walk along this street.", cn:"æ²¿ç€è¿™æ¡è¡—èµ°ã€‚" },
      { type:"repeat", en:"Walk along this street.", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Repeat!" },
      { type:"pause" },
      { type:"vocab", en:"street", cn:"å¤§è¡—ï¼›è¡—é“", phonetic:"/striËt/" },
      { type:"vocab", en:"station", cn:"å±€ï¼›æ‰€ï¼›ç«™", phonetic:"/ËˆsteÉªÊƒn/" },
      { type:"sentence", en:"Turn right at the police station.", cn:"åœ¨è­¦å¯Ÿå±€å³è½¬ã€‚" },
      { type:"repeat", en:"Turn right at the police station.", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Your turn!" },
      { type:"pause" },
      { type:"vocab", en:"cinema", cn:"ç”µå½±é™¢", phonetic:"/ËˆsÉªnÉ™mÉ™/" },
      { type:"vocab", en:"between", cn:"åœ¨â€¦â€¦ä¸­é—´", phonetic:"/bÉªËˆtwiËn/" },
      { type:"vocab", en:"behind", cn:"åœ¨â€¦â€¦çš„åé¢", phonetic:"/bÉªËˆhaÉªnd/" },
      { type:"vocab", en:"next", cn:"ç´§é‚»ï¼›ç´§æ¥ç€", phonetic:"/nekst/" },
      { type:"vocab", en:"far", cn:"è¿œçš„ï¼›è¾ƒè¿œçš„", phonetic:"/fÉ‘Ër/" },
      { type:"vocab", en:"left", cn:"å‘å·¦ï¼›å·¦è¾¹", phonetic:"/left/" },
      { type:"pause" },
      { type:"vocab", en:"teach", cn:"æ•™ï¼ˆè¯¾ç¨‹ï¼‰", phonetic:"/tiËtÊƒ/" },
      { type:"vocab", en:"litter", cn:"åƒåœ¾ï¼›åºŸå¼ƒç‰©", phonetic:"/ËˆlÉªtÉ™r/" },
      { type:"vocab", en:"recycle", cn:"å›æ”¶åˆ©ç”¨", phonetic:"/riËËˆsaÉªkl/" },
      { type:"vocab", en:"artist", cn:"è‰ºæœ¯å®¶ï¼›ç”»å®¶", phonetic:"/ËˆÉ‘ËtÉªst/" },
      { type:"vocab", en:"scientist", cn:"ç§‘å­¦å®¶", phonetic:"/ËˆsaÉªÉ™ntÉªst/" },
      { type:"vocab", en:"volunteer", cn:"å¿—æ„¿è€…", phonetic:"/ËŒvÉ’lÉ™nËˆtÉªÉ™r/" },
      { type:"pause" },
      { type:"quiz", en:"How do you say ç”µå½±é™¢ in English?", cn:"cinema", instruction:"ğŸ’¡ Answer: cinema" },
      { type:"quiz", en:"How do you say å¿—æ„¿è€… in English?", cn:"volunteer", instruction:"ğŸ’¡ Answer: volunteer" },
      { type:"title", en:"Vocabulary complete!", cn:"è¯æ±‡è®­ç»ƒå®Œæˆï¼" },
    ],
    "Dialogue A": [
      { type:"title", en:"Unit 2 Part A â€” Finding Places", cn:"ç¬¬äºŒå•å…ƒ Aéƒ¨åˆ† â€” é—®è·¯" },
      { type:"pause" },
      { type:"dialogue", en:"Excuse me. Can you help me please?", cn:"æ‰“æ‰°ä¸€ä¸‹ï¼Œä½ èƒ½å¸®å¸®æˆ‘å—ï¼Ÿ", speaker:"Boy" },
      { type:"dialogue", en:"Sure.", cn:"å½“ç„¶ã€‚", speaker:"Amy" },
      { type:"dialogue", en:"Thank you. Is there a bookshop near here?", cn:"è°¢è°¢ã€‚è¿™é™„è¿‘æœ‰ä¹¦åº—å—ï¼Ÿ", speaker:"Boy" },
      { type:"dialogue", en:"Yes, there is. Walk along this street. Turn right at the police station. The bookshop is on your right.", cn:"æœ‰çš„ã€‚æ²¿ç€è¿™æ¡è¡—èµ°ï¼Œåœ¨è­¦å¯Ÿå±€å³è½¬ã€‚ä¹¦åº—åœ¨ä½ çš„å³è¾¹ã€‚", speaker:"Amy" },
      { type:"dialogue", en:"Thank you. Is there also a library near here?", cn:"è°¢è°¢ã€‚è¿™é™„è¿‘ä¹Ÿæœ‰å›¾ä¹¦é¦†å—ï¼Ÿ", speaker:"Boy" },
      { type:"dialogue", en:"No, there isn't. But there is a big one next to the park. It's a little far.", cn:"æ²¡æœ‰ã€‚ä½†å…¬å›­æ—è¾¹æœ‰ä¸€ä¸ªå¤§çš„ã€‚æœ‰ç‚¹è¿œã€‚", speaker:"Amy" },
      { type:"dialogue", en:"OK. Thank you!", cn:"å¥½çš„ï¼Œè°¢è°¢ä½ ï¼", speaker:"Boy" },
      { type:"pause" },
      { type:"sentence", en:"Is there a bookshop near here?", cn:"è¿™é™„è¿‘æœ‰ä¹¦åº—å—ï¼Ÿ" },
      { type:"repeat", en:"Is there a bookshop near here?", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Repeat!" },
      { type:"sentence", en:"Walk along this street. Turn right at the police station.", cn:"æ²¿ç€è¿™æ¡è¡—èµ°ã€‚åœ¨è­¦å¯Ÿå±€å³è½¬ã€‚" },
      { type:"repeat", en:"Walk along this street. Turn right at the police station.", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Your turn!" },
      { type:"title", en:"Dialogue A complete!", cn:"Aéƒ¨åˆ†å¯¹è¯å®Œæˆï¼" },
    ],
    "Dialogue B": [
      { type:"title", en:"Unit 2 Part B â€” Community Helpers", cn:"ç¬¬äºŒå•å…ƒ Béƒ¨åˆ† â€” ç¤¾åŒºå·¥ä½œè€…" },
      { type:"pause" },
      { type:"dialogue", en:"There's Miss Ma! She's my teacher.", cn:"é‚£æ˜¯é©¬è€å¸ˆï¼å¥¹æ˜¯æˆ‘çš„è€å¸ˆã€‚", speaker:"Sarah" },
      { type:"dialogue", en:"What does she teach?", cn:"å¥¹æ•™ä»€ä¹ˆï¼Ÿ", speaker:"Sam" },
      { type:"dialogue", en:"She teaches maths.", cn:"å¥¹æ•™æ•°å­¦ã€‚", speaker:"Sarah" },
      { type:"dialogue", en:"What's she doing?", cn:"å¥¹åœ¨åšä»€ä¹ˆï¼Ÿ", speaker:"Sam" },
      { type:"dialogue", en:"She's picking up litter. We can recycle a lot of litter.", cn:"å¥¹åœ¨æ¡åƒåœ¾ã€‚æˆ‘ä»¬å¯ä»¥å›æ”¶å¾ˆå¤šåƒåœ¾ã€‚", speaker:"Sarah" },
      { type:"dialogue", en:"Yes. Mr Zhang recycles things too.", cn:"æ˜¯çš„ã€‚å¼ å…ˆç”Ÿä¹Ÿå›æ”¶ä¸œè¥¿ã€‚", speaker:"Sam" },
      { type:"dialogue", en:"Who's Mr Zhang? What does he do?", cn:"å¼ å…ˆç”Ÿæ˜¯è°ï¼Ÿä»–æ˜¯åšä»€ä¹ˆå·¥ä½œçš„ï¼Ÿ", speaker:"Sarah" },
      { type:"dialogue", en:"He's a street cleaner. I see him every morning.", cn:"ä»–æ˜¯æ¸…æ´å·¥ã€‚æˆ‘æ¯å¤©æ—©ä¸Šéƒ½èƒ½çœ‹åˆ°ä»–ã€‚", speaker:"Sam" },
      { type:"dialogue", en:"That's an important job!", cn:"é‚£æ˜¯ä¸€ä»½é‡è¦çš„å·¥ä½œï¼", speaker:"Sarah" },
      { type:"pause" },
      { type:"sentence", en:"What does she teach? She teaches maths.", cn:"å¥¹æ•™ä»€ä¹ˆï¼Ÿå¥¹æ•™æ•°å­¦ã€‚" },
      { type:"repeat", en:"What does she teach? She teaches maths.", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Repeat!" },
      { type:"title", en:"Unit 2 complete!", cn:"ç¬¬äºŒå•å…ƒå®Œæˆï¼" },
    ],
  },
  3: {
    "Vocabulary": [
      { type:"title", en:"Unit 3 â€” Months & Seasons", cn:"ç¬¬ä¸‰å•å…ƒ â€” æœˆä»½ä¸å­£èŠ‚" },
      { type:"vocab", en:"January", cn:"ä¸€æœˆ", phonetic:"/ËˆdÊ’Ã¦njuÉ™ri/" },
      { type:"vocab", en:"February", cn:"äºŒæœˆ", phonetic:"/ËˆfebruÉ™ri/" },
      { type:"vocab", en:"March", cn:"ä¸‰æœˆ", phonetic:"/mÉ‘ËtÊƒ/" },
      { type:"vocab", en:"April", cn:"å››æœˆ", phonetic:"/ËˆeÉªprÉ™l/" },
      { type:"vocab", en:"May", cn:"äº”æœˆ", phonetic:"/meÉª/" },
      { type:"vocab", en:"June", cn:"å…­æœˆ", phonetic:"/dÊ’uËn/" },
      { type:"pause" },
      { type:"vocab", en:"July", cn:"ä¸ƒæœˆ", phonetic:"/dÊ’uËˆlaÉª/" },
      { type:"vocab", en:"August", cn:"å…«æœˆ", phonetic:"/ËˆÉ”ËÉ¡É™st/" },
      { type:"vocab", en:"September", cn:"ä¹æœˆ", phonetic:"/sepËˆtembÉ™r/" },
      { type:"vocab", en:"October", cn:"åæœˆ", phonetic:"/É’kËˆtÉ™ÊŠbÉ™r/" },
      { type:"vocab", en:"November", cn:"åä¸€æœˆ", phonetic:"/nÉ™ÊŠËˆvembÉ™r/" },
      { type:"vocab", en:"December", cn:"åäºŒæœˆ", phonetic:"/dÉªËˆsembÉ™r/" },
      { type:"pause" },
      { type:"vocab", en:"skate", cn:"æ»‘å†°ï¼›æºœå†°", phonetic:"/skeÉªt/" },
      { type:"vocab", en:"holiday", cn:"å‡æœŸ", phonetic:"/ËˆhÉ’lÉ™deÉª/" },
      { type:"vocab", en:"celebrate", cn:"åº†ç¥", phonetic:"/ËˆselÉªbreÉªt/" },
      { type:"vocab", en:"party", cn:"èšä¼š", phonetic:"/ËˆpÉ‘Ëti/" },
      { type:"quiz", en:"How do you say å…«æœˆ in English?", cn:"August", instruction:"ğŸ’¡ Answer: August" },
      { type:"quiz", en:"How do you say åº†ç¥ in English?", cn:"celebrate", instruction:"ğŸ’¡ Answer: celebrate" },
      { type:"title", en:"Vocabulary complete!", cn:"è¯æ±‡è®­ç»ƒå®Œæˆï¼" },
    ],
    "Dialogue A": [
      { type:"title", en:"Unit 3 Part A â€” Favourite Seasons", cn:"ç¬¬ä¸‰å•å…ƒ Aéƒ¨åˆ† â€” æœ€å–œæ¬¢çš„å­£èŠ‚" },
      { type:"pause" },
      { type:"dialogue", en:"Which season do you like the best, children?", cn:"å­©å­ä»¬ï¼Œä½ ä»¬æœ€å–œæ¬¢å“ªä¸ªå­£èŠ‚ï¼Ÿ", speaker:"Mrs Green" },
      { type:"dialogue", en:"I like spring the best. The weather is nice. I often fly a kite with my father in the park.", cn:"æˆ‘æœ€å–œæ¬¢æ˜¥å¤©ã€‚å¤©æ°”å¾ˆå¥½ã€‚æˆ‘ç»å¸¸å’Œçˆ¸çˆ¸åœ¨å…¬å›­é‡Œæ”¾é£ç­ã€‚", speaker:"Zhang Peng" },
      { type:"dialogue", en:"That's nice! What about you, Oliver?", cn:"çœŸä¸é”™ï¼ä½ å‘¢ï¼ŒOliverï¼Ÿ", speaker:"Mrs Green" },
      { type:"dialogue", en:"I like summer the best. I enjoy swimming in the sea.", cn:"æˆ‘æœ€å–œæ¬¢å¤å¤©ã€‚æˆ‘å–œæ¬¢åœ¨æµ·é‡Œæ¸¸æ³³ã€‚", speaker:"Oliver" },
      { type:"dialogue", en:"I like winter the best. It snows a lot in Canada. In January and February, I often skate on the lake.", cn:"æˆ‘æœ€å–œæ¬¢å†¬å¤©ã€‚åŠ æ‹¿å¤§ç»å¸¸ä¸‹é›ªã€‚ä¸€æœˆå’ŒäºŒæœˆï¼Œæˆ‘ç»å¸¸åœ¨æ¹–ä¸Šæºœå†°ã€‚", speaker:"Mike" },
      { type:"dialogue", en:"It's warm in January and February in Australia.", cn:"åœ¨æ¾³å¤§åˆ©äºšï¼Œä¸€æœˆå’ŒäºŒæœˆæ˜¯æš–å’Œçš„ã€‚", speaker:"Oliver" },
      { type:"dialogue", en:"Really? That's interesting!", cn:"çœŸçš„å—ï¼Ÿå¤ªæœ‰è¶£äº†ï¼", speaker:"Zhang Peng" },
      { type:"pause" },
      { type:"sentence", en:"Which season do you like the best?", cn:"ä½ æœ€å–œæ¬¢å“ªä¸ªå­£èŠ‚ï¼Ÿ" },
      { type:"repeat", en:"Which season do you like the best?", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Repeat!" },
      { type:"sentence", en:"I like spring the best.", cn:"æˆ‘æœ€å–œæ¬¢æ˜¥å¤©ã€‚" },
      { type:"repeat", en:"I like spring the best.", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Your turn!" },
      { type:"title", en:"Dialogue A complete!", cn:"Aéƒ¨åˆ†å¯¹è¯å®Œæˆï¼" },
    ],
    "Dialogue B": [
      { type:"title", en:"Unit 3 Part B â€” Festivals", cn:"ç¬¬ä¸‰å•å…ƒ Béƒ¨åˆ† â€” èŠ‚æ—¥" },
      { type:"pause" },
      { type:"dialogue", en:"Class, what's the best time of year?", cn:"åŒå­¦ä»¬ï¼Œä¸€å¹´ä¸­æœ€å¥½çš„æ—¶å€™æ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿ", speaker:"Mrs Green" },
      { type:"dialogue", en:"I think it's autumn.", cn:"æˆ‘è§‰å¾—æ˜¯ç§‹å¤©ã€‚", speaker:"John" },
      { type:"dialogue", en:"Yes. There are great festivals in autumn. I love the Mid-Autumn Festival. Mooncakes are delicious.", cn:"æ˜¯çš„ã€‚ç§‹å¤©æœ‰å¾ˆå¤šå¥½çš„èŠ‚æ—¥ã€‚æˆ‘å–œæ¬¢ä¸­ç§‹èŠ‚ã€‚æœˆé¥¼å¾ˆå¥½åƒã€‚", speaker:"Binbin" },
      { type:"dialogue", en:"I like Dongzhi. I love dumplings.", cn:"æˆ‘å–œæ¬¢å†¬è‡³ã€‚æˆ‘å–œæ¬¢é¥ºå­ã€‚", speaker:"Liu Jia" },
      { type:"dialogue", en:"When's Dongzhi?", cn:"å†¬è‡³æ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿ", speaker:"Mike" },
      { type:"dialogue", en:"It's in winter. We celebrate Dongzhi in late December.", cn:"åœ¨å†¬å¤©ã€‚æˆ‘ä»¬åœ¨åäºŒæœˆä¸‹æ—¬åº†ç¥å†¬è‡³ã€‚", speaker:"Liu Jia" },
      { type:"dialogue", en:"We celebrate Christmas in December too. My mother cooks turkey. And my father puts up a big Christmas tree.", cn:"æˆ‘ä»¬ä¹Ÿåœ¨åäºŒæœˆåº†ç¥åœ£è¯èŠ‚ã€‚æˆ‘å¦ˆå¦ˆåšç«é¸¡ã€‚æˆ‘çˆ¸çˆ¸ç«‹ä¸€æ£µå¤§åœ£è¯æ ‘ã€‚", speaker:"Amy" },
      { type:"dialogue", en:"Great!", cn:"å¤ªå¥½äº†ï¼", speaker:"Mrs Green" },
      { type:"pause" },
      { type:"sentence", en:"We celebrate Dongzhi in late December.", cn:"æˆ‘ä»¬åœ¨åäºŒæœˆä¸‹æ—¬åº†ç¥å†¬è‡³ã€‚" },
      { type:"repeat", en:"We celebrate Dongzhi in late December.", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Repeat!" },
      { type:"title", en:"Unit 3 complete!", cn:"ç¬¬ä¸‰å•å…ƒå®Œæˆï¼" },
    ],
  },
  4: {
    "Vocabulary": [
      { type:"title", en:"Unit 4 â€” Vocabulary Drill", cn:"ç¬¬å››å•å…ƒ â€” è¯æ±‡è®­ç»ƒ" },
      { type:"vocab", en:"hometown", cn:"å®¶ä¹¡ï¼›æ•…ä¹¡", phonetic:"/ËˆhÉ™ÊŠmtaÊŠn/" },
      { type:"vocab", en:"common", cn:"å…±åŒçš„", phonetic:"/ËˆkÉ’mÉ™n/" },
      { type:"vocab", en:"beach", cn:"æµ·æ»©ï¼›æ²™æ»©", phonetic:"/biËtÊƒ/" },
      { type:"vocab", en:"desert", cn:"æ²™æ¼ ", phonetic:"/ËˆdezÉ™t/" },
      { type:"vocab", en:"grassland", cn:"è‰åŸ", phonetic:"/ËˆÉ¡rÉ‘ËslÃ¦nd/" },
      { type:"pause" },
      { type:"vocab", en:"special", cn:"ç‰¹åˆ«çš„", phonetic:"/ËˆspeÊƒl/" },
      { type:"vocab", en:"wild", cn:"é‡ç”Ÿçš„", phonetic:"/waÉªld/" },
      { type:"vocab", en:"kangaroo", cn:"è¢‹é¼ ", phonetic:"/ËŒkÃ¦Å‹É¡É™ËˆruË/" },
      { type:"vocab", en:"koala", cn:"è€ƒæ‹‰", phonetic:"/kÉ™ÊŠËˆÉ‘ËlÉ™/" },
      { type:"vocab", en:"island", cn:"å²›ï¼›å²›å±¿", phonetic:"/ËˆaÉªlÉ™nd/" },
      { type:"vocab", en:"wish", cn:"å¸Œæœ›", phonetic:"/wÉªÊƒ/" },
      { type:"pause" },
      { type:"quiz", en:"How do you say å®¶ä¹¡ in English?", cn:"hometown", instruction:"ğŸ’¡ Answer: hometown" },
      { type:"quiz", en:"How do you say è¢‹é¼  in English?", cn:"kangaroo", instruction:"ğŸ’¡ Answer: kangaroo" },
      { type:"title", en:"Vocabulary complete!", cn:"è¯æ±‡è®­ç»ƒå®Œæˆï¼" },
    ],
    "Dialogue A": [
      { type:"title", en:"Unit 4 Part A â€” Famous Places in China", cn:"ç¬¬å››å•å…ƒ Aéƒ¨åˆ† â€” ä¸­å›½åèƒœ" },
      { type:"pause" },
      { type:"dialogue", en:"Where is your hometown, Zhang Peng?", cn:"å¼ é¹ï¼Œä½ çš„å®¶ä¹¡åœ¨å“ªé‡Œï¼Ÿ", speaker:"Oliver" },
      { type:"dialogue", en:"I'm from Qufu in Shandong.", cn:"æˆ‘æ¥è‡ªå±±ä¸œæ›²é˜œã€‚", speaker:"Zhang Peng" },
      { type:"dialogue", en:"What's your hometown famous for?", cn:"ä½ çš„å®¶ä¹¡å› ä»€ä¹ˆè€Œå‡ºåï¼Ÿ", speaker:"Oliver" },
      { type:"dialogue", en:"It's the home of Confucius.", cn:"é‚£é‡Œæ˜¯å­”å­çš„æ•…ä¹¡ã€‚", speaker:"Zhang Peng" },
      { type:"dialogue", en:"Oh wow! What are some other famous places in China?", cn:"å“‡ï¼ä¸­å›½è¿˜æœ‰å“ªäº›è‘—åçš„åœ°æ–¹ï¼Ÿ", speaker:"Oliver" },
      { type:"dialogue", en:"China has many famous places. Sichuan is famous for its pandas.", cn:"ä¸­å›½æœ‰å¾ˆå¤šè‘—åçš„åœ°æ–¹ã€‚å››å·ä»¥å¤§ç†ŠçŒ«é—»åã€‚", speaker:"Zhang Peng" },
      { type:"dialogue", en:"Guangxi is famous for mountains and rivers. And Yunnan has beautiful forests.", cn:"å¹¿è¥¿ä»¥å±±æ°´é—»åã€‚äº‘å—æœ‰ç¾ä¸½çš„æ£®æ—ã€‚", speaker:"Binbin" },
      { type:"dialogue", en:"But all of the places in China have one thing in common.", cn:"ä½†ä¸­å›½æ‰€æœ‰çš„åœ°æ–¹éƒ½æœ‰ä¸€ä¸ªå…±åŒç‚¹ã€‚", speaker:"Zhang Peng" },
      { type:"dialogue", en:"What's that?", cn:"æ˜¯ä»€ä¹ˆï¼Ÿ", speaker:"Oliver" },
      { type:"dialogue", en:"They all have friendly people!", cn:"é‚£é‡Œéƒ½æœ‰å‹å¥½çš„äººæ°‘ï¼", speaker:"Zhang Peng" },
      { type:"pause" },
      { type:"sentence", en:"What's your hometown famous for?", cn:"ä½ çš„å®¶ä¹¡å› ä»€ä¹ˆè€Œå‡ºåï¼Ÿ" },
      { type:"repeat", en:"What's your hometown famous for?", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Repeat!" },
      { type:"sentence", en:"Sichuan is famous for its pandas.", cn:"å››å·ä»¥å¤§ç†ŠçŒ«é—»åã€‚" },
      { type:"repeat", en:"Sichuan is famous for its pandas.", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Your turn!" },
      { type:"title", en:"Dialogue A complete!", cn:"Aéƒ¨åˆ†å¯¹è¯å®Œæˆï¼" },
    ],
    "Dialogue B": [
      { type:"title", en:"Unit 4 Part B â€” Countries of the World", cn:"ç¬¬å››å•å…ƒ Béƒ¨åˆ† â€” ä¸–ç•Œå„å›½" },
      { type:"pause" },
      { type:"dialogue", en:"Oliver, you come from Australia, don't you?", cn:"Oliverï¼Œä½ æ¥è‡ªæ¾³å¤§åˆ©äºšï¼Œå¯¹å§ï¼Ÿ", speaker:"Sarah" },
      { type:"dialogue", en:"Yes, I do.", cn:"æ˜¯çš„ã€‚", speaker:"Oliver" },
      { type:"dialogue", en:"What makes Australia special?", cn:"æ¾³å¤§åˆ©äºšæœ‰ä»€ä¹ˆç‰¹åˆ«çš„ï¼Ÿ", speaker:"Sarah" },
      { type:"dialogue", en:"The good weather and beautiful beaches.", cn:"å¥½å¤©æ°”å’Œç¾ä¸½çš„æµ·æ»©ã€‚", speaker:"Oliver" },
      { type:"dialogue", en:"Australia also has many wild animals. It's famous for its kangaroos and koalas.", cn:"æ¾³å¤§åˆ©äºšä¹Ÿæœ‰å¾ˆå¤šé‡ç”ŸåŠ¨ç‰©ã€‚é‚£é‡Œä»¥è¢‹é¼ å’Œè€ƒæ‹‰é—»åã€‚", speaker:"Mike" },
      { type:"dialogue", en:"That's right. But I wish I could visit India. It's so colourful, and there are many interesting festivals.", cn:"æ²¡é”™ã€‚ä½†æˆ‘å¸Œæœ›èƒ½å»å°åº¦ã€‚é‚£é‡Œå¤šå§¿å¤šå½©ï¼Œæœ‰å¾ˆå¤šæœ‰è¶£çš„èŠ‚æ—¥ã€‚", speaker:"Oliver" },
      { type:"dialogue", en:"That sounds great. I really want to go to Italy this year.", cn:"å¬èµ·æ¥å¤ªæ£’äº†ã€‚æˆ‘ä»Šå¹´çœŸçš„æƒ³å»æ„å¤§åˆ©ã€‚", speaker:"Sarah" },
      { type:"dialogue", en:"What makes Italy special?", cn:"æ„å¤§åˆ©æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ï¼Ÿ", speaker:"Oliver" },
      { type:"dialogue", en:"Food and football!", cn:"ç¾é£Ÿå’Œè¶³çƒï¼", speaker:"Sarah" },
      { type:"pause" },
      { type:"sentence", en:"What makes Australia special?", cn:"æ¾³å¤§åˆ©äºšæœ‰ä»€ä¹ˆç‰¹åˆ«çš„ï¼Ÿ" },
      { type:"repeat", en:"What makes Australia special?", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Repeat!" },
      { type:"title", en:"Unit 4 complete!", cn:"ç¬¬å››å•å…ƒå®Œæˆï¼" },
    ],
  },
  5: {
    "Vocabulary": [
      { type:"title", en:"Unit 5 â€” Vocabulary Drill", cn:"ç¬¬äº”å•å…ƒ â€” è¯æ±‡è®­ç»ƒ" },
      { type:"vocab", en:"early", cn:"æ—©åˆ°çš„", phonetic:"/ËˆÉœËli/" },
      { type:"vocab", en:"underground", cn:"åœ°é“", phonetic:"/ËˆÊŒndÉ™É¡raÊŠnd/" },
      { type:"vocab", en:"bike", cn:"è‡ªè¡Œè½¦", phonetic:"/baÉªk/" },
      { type:"vocab", en:"foot", cn:"è„šï¼›æ­¥è¡Œ", phonetic:"/fÊŠt/" },
      { type:"sentence", en:"I usually go on foot.", cn:"æˆ‘é€šå¸¸æ­¥è¡Œã€‚" },
      { type:"repeat", en:"I usually go on foot.", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Repeat!" },
      { type:"pause" },
      { type:"vocab", en:"plane", cn:"é£æœº", phonetic:"/pleÉªn/" },
      { type:"vocab", en:"ship", cn:"ï¼ˆå¤§ï¼‰èˆ¹", phonetic:"/ÊƒÉªp/" },
      { type:"vocab", en:"travel", cn:"æ—…è¡Œ", phonetic:"/ËˆtrÃ¦vl/" },
      { type:"vocab", en:"environment", cn:"è‡ªç„¶ç¯å¢ƒ", phonetic:"/ÉªnËˆvaÉªrÉ™nmÉ™nt/" },
      { type:"vocab", en:"health", cn:"å¥åº·", phonetic:"/helÎ¸/" },
      { type:"pause" },
      { type:"quiz", en:"How do you say åœ°é“ in English?", cn:"underground", instruction:"ğŸ’¡ Answer: underground" },
      { type:"quiz", en:"How do you say è‡ªè¡Œè½¦ in English?", cn:"bike", instruction:"ğŸ’¡ Answer: bike" },
      { type:"title", en:"Vocabulary complete!", cn:"è¯æ±‡è®­ç»ƒå®Œæˆï¼" },
    ],
    "Dialogue A": [
      { type:"title", en:"Unit 5 Part A â€” Getting to School", cn:"ç¬¬äº”å•å…ƒ Aéƒ¨åˆ† â€” ä¸Šå­¦æ–¹å¼" },
      { type:"pause" },
      { type:"dialogue", en:"Hi, children. You're early today.", cn:"ä½ å¥½ï¼Œå­©å­ä»¬ã€‚ä½ ä»¬ä»Šå¤©æ¥å¾—æ—©ã€‚", speaker:"Miss White" },
      { type:"dialogue", en:"Yes, we are.", cn:"æ˜¯çš„ã€‚", speaker:"Binbin" },
      { type:"dialogue", en:"Wonderful! How do you come to school?", cn:"å¤ªå¥½äº†ï¼ä½ ä»¬æ€ä¹ˆæ¥å­¦æ ¡çš„ï¼Ÿ", speaker:"Miss White" },
      { type:"dialogue", en:"Sometimes my father brings me to school by car, but I often take the underground. It's fast.", cn:"æœ‰æ—¶å€™çˆ¸çˆ¸å¼€è½¦é€æˆ‘ä¸Šå­¦ï¼Œä½†æˆ‘ç»å¸¸ååœ°é“ã€‚åœ°é“å¾ˆå¿«ã€‚", speaker:"Binbin" },
      { type:"dialogue", en:"Yes. There is no traffic.", cn:"æ˜¯çš„ï¼Œä¸ä¼šå µè½¦ã€‚", speaker:"Miss White" },
      { type:"dialogue", en:"I often come by bus. How do you come to school, Miss White?", cn:"æˆ‘ç»å¸¸åå…¬äº¤è½¦ã€‚æ€€ç‰¹è€å¸ˆï¼Œæ‚¨æ€ä¹ˆæ¥å­¦æ ¡ï¼Ÿ", speaker:"Chen Jie" },
      { type:"dialogue", en:"Sometimes I ride my bike, but I usually walk. I like to exercise.", cn:"æœ‰æ—¶å€™éª‘è‡ªè¡Œè½¦ï¼Œä½†é€šå¸¸æ­¥è¡Œã€‚æˆ‘å–œæ¬¢é”»ç‚¼ã€‚", speaker:"Miss White" },
      { type:"pause" },
      { type:"sentence", en:"How do you come to school?", cn:"ä½ æ€ä¹ˆæ¥å­¦æ ¡çš„ï¼Ÿ" },
      { type:"repeat", en:"How do you come to school?", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Repeat!" },
      { type:"sentence", en:"I often take the underground.", cn:"æˆ‘ç»å¸¸ååœ°é“ã€‚" },
      { type:"repeat", en:"I often take the underground.", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Your turn!" },
      { type:"title", en:"Dialogue A complete!", cn:"Aéƒ¨åˆ†å¯¹è¯å®Œæˆï¼" },
    ],
    "Dialogue B": [
      { type:"title", en:"Unit 5 Part B â€” After School Plans", cn:"ç¬¬äº”å•å…ƒ Béƒ¨åˆ† â€” æ”¾å­¦åçš„è®¡åˆ’" },
      { type:"pause" },
      { type:"dialogue", en:"Hi, Sarah. Where are you going?", cn:"å—¨ï¼ŒSarahã€‚ä½ è¦å»å“ªé‡Œï¼Ÿ", speaker:"Amy" },
      { type:"dialogue", en:"I'm going to my dance class.", cn:"æˆ‘è¦å»ä¸Šèˆè¹ˆè¯¾ã€‚", speaker:"Sarah" },
      { type:"dialogue", en:"That sounds fun.", cn:"å¬èµ·æ¥å¾ˆæœ‰è¶£ã€‚", speaker:"Amy" },
      { type:"dialogue", en:"Yes. I go every Tuesday and Sunday. My class is in the city centre.", cn:"æ˜¯çš„ã€‚æˆ‘æ¯å‘¨äºŒå’Œå‘¨æ—¥éƒ½å»ã€‚æˆ‘çš„è¯¾åœ¨å¸‚ä¸­å¿ƒã€‚", speaker:"Sarah" },
      { type:"dialogue", en:"That's far. Are you going by bus?", cn:"é‚£å¾ˆè¿œã€‚ä½ åå…¬äº¤è½¦å»å—ï¼Ÿ", speaker:"Amy" },
      { type:"dialogue", en:"Yes. A taxi is too expensive. What are you going to do?", cn:"æ˜¯çš„ã€‚å‡ºç§Ÿè½¦å¤ªè´µäº†ã€‚ä½ æ‰“ç®—åšä»€ä¹ˆï¼Ÿ", speaker:"Sarah" },
      { type:"dialogue", en:"I'm going to visit my grandparents. We're going to watch a film together.", cn:"æˆ‘è¦å»çœ‹æœ›çˆ·çˆ·å¥¶å¥¶ã€‚æˆ‘ä»¬è¦ä¸€èµ·çœ‹ç”µå½±ã€‚", speaker:"Amy" },
      { type:"dialogue", en:"My grandparents often choose old black and white films!", cn:"æˆ‘çš„çˆ·çˆ·å¥¶å¥¶ç»å¸¸é€‰è€çš„é»‘ç™½ç”µå½±ï¼", speaker:"Amy" },
      { type:"dialogue", en:"That will be interesting!", cn:"é‚£ä¸€å®šå¾ˆæœ‰è¶£ï¼", speaker:"Sarah" },
      { type:"pause" },
      { type:"sentence", en:"Where are you going?", cn:"ä½ è¦å»å“ªé‡Œï¼Ÿ" },
      { type:"repeat", en:"Where are you going?", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Repeat!" },
      { type:"title", en:"Unit 5 complete!", cn:"ç¬¬äº”å•å…ƒå®Œæˆï¼" },
    ],
  },
  6: {
    "Vocabulary": [
      { type:"title", en:"Unit 6 â€” Vocabulary Drill", cn:"ç¬¬å…­å•å…ƒ â€” è¯æ±‡è®­ç»ƒ" },
      { type:"vocab", en:"internet", cn:"å› ç‰¹ç½‘ï¼›äº’è”ç½‘", phonetic:"/ËˆÉªntÉ™net/" },
      { type:"vocab", en:"seafood", cn:"æµ·é²œ", phonetic:"/ËˆsiËfuËd/" },
      { type:"vocab", en:"maybe", cn:"æˆ–è®¸ï¼›å¤§æ¦‚", phonetic:"/ËˆmeÉªbi/" },
      { type:"vocab", en:"join", cn:"å‚ä¸ï¼›åŠ å…¥", phonetic:"/dÊ’É”Éªn/" },
      { type:"pause" },
      { type:"vocab", en:"explore", cn:"æ¢ç´¢", phonetic:"/ÉªkËˆsplÉ”Ër/" },
      { type:"vocab", en:"culture", cn:"æ–‡åŒ–", phonetic:"/ËˆkÊŒltÊƒÉ™r/" },
      { type:"vocab", en:"hot pot", cn:"ç«é”…", phonetic:"/hÉ’t pÉ’t/" },
      { type:"vocab", en:"tour", cn:"æ—…è¡Œ", phonetic:"/tÊŠÉ™r/" },
      { type:"vocab", en:"local", cn:"å½“åœ°çš„", phonetic:"/ËˆlÉ™ÊŠkl/" },
      { type:"vocab", en:"history", cn:"å†å²", phonetic:"/ËˆhÉªstri/" },
      { type:"vocab", en:"plan", cn:"è®¡åˆ’", phonetic:"/plÃ¦n/" },
      { type:"pause" },
      { type:"quiz", en:"How do you say ç«é”… in English?", cn:"hot pot", instruction:"ğŸ’¡ Answer: hot pot" },
      { type:"quiz", en:"How do you say æ¢ç´¢ in English?", cn:"explore", instruction:"ğŸ’¡ Answer: explore" },
      { type:"title", en:"Vocabulary complete!", cn:"è¯æ±‡è®­ç»ƒå®Œæˆï¼" },
    ],
    "Dialogue A": [
      { type:"title", en:"Unit 6 Part A â€” Summer Holiday Plans", cn:"ç¬¬å…­å•å…ƒ Aéƒ¨åˆ† â€” æš‘å‡è®¡åˆ’" },
      { type:"pause" },
      { type:"dialogue", en:"Where are you going in the summer holidays, Zhang Peng?", cn:"å¼ é¹ï¼Œæš‘å‡ä½ è¦å»å“ªé‡Œï¼Ÿ", speaker:"John" },
      { type:"dialogue", en:"I'm going to Dalian with my family. And you?", cn:"æˆ‘è¦å’Œå®¶äººå»å¤§è¿ã€‚ä½ å‘¢ï¼Ÿ", speaker:"Zhang Peng" },
      { type:"dialogue", en:"I'll stay here. I can see everything on the internet.", cn:"æˆ‘ä¼šå¾…åœ¨è¿™é‡Œã€‚æˆ‘å¯ä»¥åœ¨ç½‘ä¸Šçœ‹åˆ°ä¸€åˆ‡ã€‚", speaker:"John" },
      { type:"dialogue", en:"I like to visit museums and take photos. And you can't eat fresh seafood online!", cn:"æˆ‘å–œæ¬¢å‚è§‚åšç‰©é¦†å’Œæ‹ç…§ã€‚è€Œä¸”ä½ ä¸èƒ½åœ¨ç½‘ä¸Šåƒåˆ°æ–°é²œçš„æµ·é²œï¼", speaker:"Zhang Peng" },
      { type:"dialogue", en:"I see. But isn't travelling expensive?", cn:"æˆ‘æ˜ç™½äº†ã€‚ä½†æ—…è¡Œä¸æ˜¯å¾ˆè´µå—ï¼Ÿ", speaker:"John" },
      { type:"dialogue", en:"Sometimes, but it's fun and you can learn a lot.", cn:"æœ‰æ—¶å€™æ˜¯çš„ï¼Œä½†å¾ˆæœ‰è¶£ï¼Œä½ èƒ½å­¦åˆ°å¾ˆå¤šä¸œè¥¿ã€‚", speaker:"Zhang Peng" },
      { type:"dialogue", en:"That's right. When are you going to Dalian?", cn:"ä½ è¯´å¾—å¯¹ã€‚ä½ ä»€ä¹ˆæ—¶å€™å»å¤§è¿ï¼Ÿ", speaker:"John" },
      { type:"dialogue", en:"In July.", cn:"ä¸ƒæœˆã€‚", speaker:"Zhang Peng" },
      { type:"dialogue", en:"OK. Maybe I can join you!", cn:"å¥½çš„ã€‚ä¹Ÿè®¸æˆ‘å¯ä»¥åŠ å…¥ä½ ä»¬ï¼", speaker:"John" },
      { type:"pause" },
      { type:"sentence", en:"Where are you going in the summer holidays?", cn:"æš‘å‡ä½ è¦å»å“ªé‡Œï¼Ÿ" },
      { type:"repeat", en:"Where are you going in the summer holidays?", cn:"è¯·è·Ÿè¯»", instruction:"ğŸ¤ Repeat!" },
      { type:"title", en:"Dialogue A complete!", cn:"Aéƒ¨åˆ†å¯¹è¯å®Œæˆï¼" },
    ],
    "Dialogue B": [
      { type:"title", en:"Unit 6 Part B â€” Making a Plan", cn:"ç¬¬å…­å•å…ƒ Béƒ¨åˆ† â€” åˆ¶å®šæ—…è¡Œè®¡åˆ’" },
      { type:"pause" },
      { type:"dialogue", en:"Sarah! We're going to make a travel plan. Can you help?", cn:"Sarahï¼æˆ‘ä»¬è¦åšä¸€ä¸ªæ—…è¡Œè®¡åˆ’ã€‚ä½ èƒ½å¸®å¿™å—ï¼Ÿ", speaker:"Mum" },
      { type:"dialogue", en:"Yes, Mum. How can we make a good travel plan?", cn:"å¥½çš„ï¼Œå¦ˆå¦ˆã€‚æˆ‘ä»¬æ€ä¹ˆåšä¸€ä¸ªå¥½çš„æ—…è¡Œè®¡åˆ’ï¼Ÿ", speaker:"Sarah" },
      { type:"dialogue", en:"Well, first, we need to choose where to go. Maybe we can go to Chongqing.", cn:"å—¯ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦é€‰æ‹©å»å“ªé‡Œã€‚ä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥å»é‡åº†ã€‚", speaker:"Mum" },
      { type:"dialogue", en:"OK. Great!", cn:"å¥½çš„ã€‚å¤ªå¥½äº†ï¼", speaker:"Sarah" },
      { type:"dialogue", en:"Then we need to choose how to get there.", cn:"ç„¶åæˆ‘ä»¬éœ€è¦é€‰æ‹©æ€ä¹ˆå»ã€‚", speaker:"Mum" },
      { type:"dialogue", en:"Many people take the fast train.", cn:"å¾ˆå¤šäººåé«˜é“ã€‚", speaker:"Sarah" },
      { type:"dialogue", en:"The fast train is a good idea!", cn:"åé«˜é“æ˜¯ä¸ªå¥½ä¸»æ„ï¼", speaker:"Dad" },
      { type:"dialogue", en:"Next, we should look for hotels.", cn:"æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åº”è¯¥æ‰¾é…’åº—ã€‚", speaker:"Mum" },
      { type:"dialogue", en:"I can look for hotels online. What else?", cn:"æˆ‘å¯ä»¥åœ¨ç½‘ä¸Šæ‰¾é…’åº—ã€‚è¿˜æœ‰ä»€ä¹ˆï¼Ÿ", speaker:"Dad" },
      { type:"dialogue", en:"Finally, we should find out about the weather.", cn:"æœ€åï¼Œæˆ‘ä»¬åº”è¯¥äº†è§£å¤©æ°”æƒ…å†µã€‚", speaker:"Mum" },
      { type:"dialogue", en:"OK. I'll check my weather app. This will be a great holiday!", cn:"å¥½çš„ã€‚æˆ‘æ¥æŸ¥å¤©æ°”é¢„æŠ¥ã€‚è¿™ä¼šæ˜¯ä¸€ä¸ªå¾ˆæ£’çš„å‡æœŸï¼", speaker:"Sarah" },
      { type:"pause" },
      { type:"sentence", en:"First, choose where to go. Then, choose how to get there. Next, look for hotels. Finally, find out about the weather.", cn:"é¦–å…ˆé€‰æ‹©å»å“ªé‡Œã€‚ç„¶åé€‰æ‹©æ€ä¹ˆå»ã€‚æ¥ä¸‹æ¥æ‰¾é…’åº—ã€‚æœ€åäº†è§£å¤©æ°”ã€‚" },
      { type:"repeat", en:"First, then, next, finally.", cn:"è¯·è·Ÿè¯»è¿™å››ä¸ªé¡ºåºè¯", instruction:"ğŸ¤ Repeat the sequence words!" },
      { type:"title", en:"All units complete! You're amazing!", cn:"æ‰€æœ‰å•å…ƒå®Œæˆï¼ä½ å¤ªå‰å®³äº†ï¼ğŸ‰" },
    ],
  },
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SPEECH ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let synth = window.speechSynthesis;
let enVoice = null, zhVoice = null;
let currentUnit = 1, currentLesson = "Vocabulary";
let currentSteps = [], stepIndex = -1;
let isPlaying = false, speed = 0.85;

function loadVoices() {
  const voices = synth.getVoices();
  // Find best English voice
  enVoice = voices.find(v => v.lang === 'en-US' && v.name.includes('Google')) ||
            voices.find(v => v.lang === 'en-US' && v.name.includes('Samantha')) ||
            voices.find(v => v.lang === 'en-US') ||
            voices.find(v => v.lang.startsWith('en'));
  // Find best Chinese voice
  zhVoice = voices.find(v => v.lang === 'zh-CN' && v.name.includes('Google')) ||
            voices.find(v => v.lang === 'zh-CN') ||
            voices.find(v => v.lang.startsWith('zh'));

  const status = document.getElementById('voiceStatus');
  if (enVoice) {
    status.textContent = 'READY';
    status.className = 'voice-status ready';
  } else {
    status.textContent = 'NO VOICE';
    status.className = 'voice-status error';
  }
}

synth.onvoiceschanged = loadVoices;
setTimeout(loadVoices, 500);

function speak(text, lang='en', rate=1) {
  return new Promise(resolve => {
    synth.cancel();
    const utter = new SpeechSynthesisUtterance(text);
    utter.voice = lang === 'zh' ? (zhVoice || enVoice) : enVoice;
    utter.lang = lang === 'zh' ? 'zh-CN' : 'en-US';
    utter.rate = rate * speed;
    utter.pitch = lang === 'zh' ? 1.0 : 1.05;
    utter.onend = resolve;
    utter.onerror = resolve;
    synth.speak(utter);
  });
}

function wait(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PLAYBACK ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function playStep(idx) {
  if (idx < 0 || idx >= currentSteps.length || !isPlaying) return;
  stepIndex = idx;
  const step = currentSteps[idx];
  updateDisplay(step);
  updateProgress();
  highlightScript(idx);

  switch(step.type) {
    case 'title':
      await speak(step.en, 'en');
      await wait(400);
      if (step.cn && zhVoice) { await speak(step.cn, 'zh'); }
      await wait(800);
      break;
    case 'vocab':
      await speak(step.en, 'en', 0.85);
      await wait(300);
      await speak(step.en, 'en', 0.7); // repeat slowly
      await wait(400);
      if (step.cn && zhVoice) { await speak(step.cn, 'zh'); }
      await wait(600);
      break;
    case 'sentence':
      await speak(step.en, 'en');
      await wait(500);
      if (step.cn && zhVoice) { await speak(step.cn, 'zh'); }
      await wait(500);
      break;
    case 'dialogue':
      await speak(step.en, 'en');
      await wait(400);
      if (step.cn && zhVoice) { await speak(step.cn, 'zh', 1.1); }
      await wait(600);
      break;
    case 'repeat':
      await speak(step.en, 'en');
      await wait(600);
      await speak(step.en, 'en', 0.75); // slow repeat
      await wait(2500); // pause for user to repeat
      break;
    case 'quiz':
      await speak(step.en, 'en');
      await wait(3000); // thinking time
      await speak(step.cn, 'en'); // answer in English
      await wait(800);
      break;
    case 'pause':
      await wait(1200);
      break;
  }

  if (isPlaying && idx + 1 < currentSteps.length) {
    playStep(idx + 1);
  } else if (idx + 1 >= currentSteps.length) {
    stopPlay();
  }
}

function updateDisplay(step) {
  const idle = document.getElementById('idleState');
  const wave = document.getElementById('waveBars');
  const npStep = document.getElementById('npStep');
  const npEn = document.getElementById('npEnglish');
  const npCn = document.getElementById('npChinese');
  const npPh = document.getElementById('npPhonetic');
  const npInst = document.getElementById('npInstruction');

  idle.style.display = 'none';
  wave.classList.remove('hidden');

  const labels = {
    title: 'ğŸ“¢ ANNOUNCEMENT', vocab: 'ğŸ“– NEW WORD', sentence: 'ğŸ’¬ KEY SENTENCE',
    dialogue: 'ğŸ—£ï¸ DIALOGUE', repeat: 'ğŸ¤ REPEAT AFTER ME', quiz: 'ğŸ§  QUICK QUIZ', pause: 'â¸ PAUSE'
  };

  npStep.style.display = 'block';
  npStep.textContent = step.speaker ? `ğŸ—£ï¸ ${step.speaker}` : (labels[step.type] || '');

  npEn.style.display = step.en ? 'block' : 'none';
  npEn.textContent = step.en || '';

  npCn.style.display = step.cn ? 'block' : 'none';
  npCn.textContent = step.cn || '';

  npPh.style.display = step.phonetic ? 'block' : 'none';
  npPh.textContent = step.phonetic || '';

  npInst.style.display = step.instruction ? 'flex' : 'none';
  npInst.textContent = step.instruction || '';
}

function updateProgress() {
  const pct = currentSteps.length > 0 ? ((stepIndex + 1) / currentSteps.length * 100) : 0;
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressCurrent').textContent = `${stepIndex + 1} / ${currentSteps.length}`;
  document.getElementById('progressPct').textContent = Math.round(pct) + '%';
}

function highlightScript(idx) {
  document.querySelectorAll('.script-item').forEach((el, i) => {
    el.classList.toggle('current', i === idx);
  });
  const current = document.querySelector('.script-item.current');
  if (current) current.scrollIntoView({ behavior:'smooth', block:'nearest' });
}

function togglePlay() {
  if (isPlaying) {
    isPlaying = false;
    synth.cancel();
    document.getElementById('playBtn').textContent = 'â–¶';
    document.getElementById('playBtn').classList.remove('playing');
    document.getElementById('waveBars').classList.add('hidden');
  } else {
    isPlaying = true;
    document.getElementById('playBtn').textContent = 'â¸';
    document.getElementById('playBtn').classList.add('playing');
    document.getElementById('waveBars').classList.remove('hidden');
    if (stepIndex < 0 || stepIndex >= currentSteps.length - 1) stepIndex = -1;
    playStep(stepIndex + 1);
  }
}

function stopPlay() {
  isPlaying = false;
  synth.cancel();
  stepIndex = -1;
  document.getElementById('playBtn').textContent = 'â–¶';
  document.getElementById('playBtn').classList.remove('playing');
  document.getElementById('waveBars').classList.add('hidden');
}

function skipNext() {
  if (!isPlaying) return;
  synth.cancel();
}

function skipPrev() {
  if (!isPlaying || stepIndex <= 0) return;
  synth.cancel();
  stepIndex = Math.max(0, stepIndex - 2);
}

function replayCurrent() {
  if (stepIndex < 0) return;
  synth.cancel();
  const wasPlaying = isPlaying;
  isPlaying = true;
  if (!wasPlaying) {
    document.getElementById('playBtn').textContent = 'â¸';
    document.getElementById('playBtn').classList.add('playing');
  }
  playStep(stepIndex);
}

function setSpeed(s) {
  speed = s;
  document.querySelectorAll('.speed-btn').forEach(b => b.classList.toggle('active', parseFloat(b.dataset.speed) === s));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UI RENDERING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderUnits() {
  const grid = document.getElementById('unitGrid');
  grid.innerHTML = UNITS.map(u => `
    <div class="unit-btn ${u.id===1?'active':''}" onclick="selectUnit(${u.id})" data-unit="${u.id}">
      <div class="unit-num">${u.id}</div>
      <div class="unit-name">${u.name}</div>
    </div>
  `).join('');
}

function selectUnit(id) {
  currentUnit = id;
  stopPlay();
  document.querySelectorAll('.unit-btn').forEach(b => b.classList.toggle('active', parseInt(b.dataset.unit) === id));
  const lessons = LESSON_DATA[id];
  if (!lessons) return;
  const keys = Object.keys(lessons);
  currentLesson = keys[0];
  renderLessonTabs(keys);
  loadLesson();
}

function renderLessonTabs(keys) {
  const tabs = document.getElementById('lessonTabs');
  tabs.innerHTML = keys.map((k, i) => `
    <button class="lesson-tab ${i===0?'active':''}" onclick="selectLesson('${k}', this)">${k}</button>
  `).join('');
}

function selectLesson(name, btn) {
  currentLesson = name;
  stopPlay();
  document.querySelectorAll('.lesson-tab').forEach(b => b.classList.remove('active'));
  if (btn) btn.classList.add('active');
  loadLesson();
}

function loadLesson() {
  const unit = UNITS.find(u => u.id === currentUnit);
  currentSteps = LESSON_DATA[currentUnit]?.[currentLesson] || [];
  stepIndex = -1;

  document.getElementById('playerTitle').textContent = `Unit ${currentUnit}: ${currentLesson}`;
  document.getElementById('playerSub').textContent = `${unit.name} Â· ${currentSteps.length} steps`;
  document.getElementById('playerIcon').style.background = `linear-gradient(135deg, ${unit.color}, ${unit.color}cc)`;

  // Reset display
  document.getElementById('idleState').style.display = 'block';
  document.getElementById('waveBars').classList.add('hidden');
  ['npStep','npEnglish','npChinese','npPhonetic','npInstruction'].forEach(id => {
    document.getElementById(id).style.display = 'none';
  });
  updateProgress();
  renderScript();
}

function renderScript() {
  const list = document.getElementById('scriptList');
  list.innerHTML = currentSteps.filter(s => s.en).map((s, i) => `
    <div class="script-item" onclick="jumpTo(${i})">
      <div class="script-idx">${i+1}</div>
      <div>
        <div class="script-text-en">${s.speaker ? `[${s.speaker}] ` : ''}${s.en}</div>
        ${s.cn ? `<div class="script-text-cn">${s.cn}</div>` : ''}
      </div>
    </div>
  `).join('');
}

function jumpTo(idx) {
  synth.cancel();
  stepIndex = idx - 1;
  isPlaying = true;
  document.getElementById('playBtn').textContent = 'â¸';
  document.getElementById('playBtn').classList.add('playing');
  playStep(idx);
}

function toggleScript() {
  document.getElementById('scriptList').classList.toggle('show');
}

// INIT
renderUnits();
selectUnit(1);
</script>
</body>
</html>
